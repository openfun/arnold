# Delete objects for the targeted deployment_stamp
- name: Set targetted deployment stamp
  set_fact:
    targeted_deployment_stamp: "{{ app_deployment_stamp | default(none) }}"

- name: Iterate over objects to delete with deployment_stamp {{ targeted_deployment_stamp }} for app {{ app.name }}
  include_tasks: tasks/delete_app_objects_kind.yml
  loop:
    - Endpoints
    - Service
    - ConfigMap
    - Job
    - DeploymentConfig
    # Manually handle deletion cascade as the k8s module won't
    # https://github.com/ansible/ansible/issues/42302
    - ReplicationController
    - Pod
  loop_control:
    loop_var: kind
  tags: deploy
